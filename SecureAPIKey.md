# API 密钥安全方案

## 当前实现的安全措施：

### 1. **分层保护**
- **第一层**：尝试从 Info.plist 读取（构建时注入）
- **第二层**：从 Keychain 读取（最安全）
- **第三层**：Debug 模式使用混淆的密钥

### 2. **混淆技术**
- API 密钥被分割成多个部分
- 反向存储，运行时才组合
- 避免在二进制文件中出现完整密钥

### 3. **构建配置**
- Release 版本强制从 Info.plist 或 Keychain 读取
- Debug 版本使用混淆密钥
- `.xcconfig` 文件已加入 `.gitignore`

## 最佳实践：

### 选项 1：使用 Keychain（推荐）
```swift
// 首次启动时保存密钥到 Keychain
KeychainHelper.shared.saveApiKey("your-api-key")
```

### 选项 2：构建时注入
1. 在 CI/CD 环境变量中设置 API 密钥
2. 构建脚本将密钥注入 Info.plist
3. App 运行时从 Info.plist 读取

### 选项 3：远程配置
- 从你的服务器获取 API 密钥
- 使用证书固定确保安全
- 可以随时更换密钥

## 额外安全建议：

1. **限制 API 密钥权限**
   - 在 OpenWeatherMap 设置 IP 白名单
   - 设置请求限制

2. **监控使用情况**
   - 定期检查 API 使用量
   - 发现异常立即更换密钥

3. **代码混淆**
   - 使用工具如 SwiftShield 混淆关键代码
   - 增加逆向工程难度

## 注意事项：
- 即使使用了这些保护措施，有决心的攻击者仍可能提取密钥
- 最安全的方案是使用自己的后端服务器作为代理
- 定期更换 API 密钥是好习惯